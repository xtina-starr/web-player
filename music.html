<!doctype html>
<html>
  <head>
    <title>Music</title>
    <link rel="stylesheet" type="text/css" href="day.css">
    <link href='http://fonts.googleapis.com/css?family=Londrina+Shadow' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Megrim' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Monoton' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Londrina+Outline' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  </head>

  <h1 class="center">Jams</h1>

  <body>
    <div class="center" id="audio">
      <audio id="player" controls="controls" autoplay>
        <!-- <source src="thehealer.mp3" type="audio/mpeg" autoplay/> -->
        <source src="thehealer.mp3" type="audio/ogg" autoplay/>
        Your browser does not support the <code>audio</code> element.
      </audio>

      <p class="playing">Erykah Badu - The Healer</p>

      <div id="controls">
        <button id="back">Back</button>
        <button id="next">Next</button>
      </div>
    </div>

      

    <ul id="playlist">
      <li class="others">
        <a data-src="thehealer.mp3" href="#">Erykah Badu - The Healer</a>
      </li>
      <li class="others">
        <a data-src="beyond.mp3" href="#">Daft Punk - Beyond</a>
      </li>
      <li class="others">
        <a data-src="thebigpayback.mp3" href="#">James Brown - The Big Payback</a>
      </li>
      <li>
        <a data-src="spottieottiedopaliscious.mp3" href="#">OutKast - Spottieottiedopaliscious</a>
      </li>
      <li id="last">
        <a data-src="empireants.mp3" href="#">Gorillaz - Empire Ants (Feat. Little Dragon)</a>
      </li>
    </ul>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

    <script>
      (function() {
        var tracks = $('ul#playlist li a'),
        len = tracks.length - 1,
        player = $('#player')[0],
        playlist = $('#playlist'),
        songs = [],
        numOfTracks = tracks.length;

        // for (i=0; i<numOfTracks; i++) {
        //   songs.push(tracks[i].getAttribute('data-src'));
        // }

        tracks.each(function(index, track) {
          songs.push(track.getAttribute('data-src'));
        });

        // var linkTags = playlist.find('a');

        // linkTags.each(function(index,track) {
        //   songs.push(track.getAttribute('data-src'));
        // });

        // plays clicked link
        tracks.click(function() {
          var link = $(this),
          // trackName = $('audio p.playing');
          src = link.data('src'),
          sourceEl = $('#player:first-child').attr('src', src);

          if ($('#audio').find('p.playing').length > 0) {
            $('#audio').find('p.playing').text(link.text());
          } 
          // else {
          //   $('<p class=playing></p>').text(link.text())
          //   .insertAfter('audio:first');
          // }
        });

        // use buttons to skip to next/back tracks
        var currentSrc = $('#player').children()[0].getAttribute('src'),
            nextButton = $('button#next'),
            currentIndex = songs.indexOf(currentSrc),
            backButton = $('button#back');

        // skip to next track
        nextButton.click(function() {
          if (currentIndex >= (numOfTracks - 1)) {
            alert(currentIndex);
            nextButton.attr('disabled', 'disabled')
            //currentIndex = 0;
            // $('#player:first-child').attr('src', songs[currentIndex]);
          } else {
            console.log(currentIndex);
            ++currentIndex;
            console.log(currentIndex);
            backButton.removeAttr('disabled');
            $('#player:first-child').attr('src', songs[currentIndex]);
          };
        });

        // go back a track
        backButton.click(function() {
          // if (currentIndex < 1) {
          if (currentIndex == 0) {
            // --currentIndex;
            backButton.attr('disabled', 'disabled');
          } else {
            currentIndex = currentIndex - 1;
            nextButton.removeAttr('disabled');
            $('#player:first-child').attr('src', songs[currentIndex]);
          }
        })

        // when song ends plays next track
        player.addEventListener('ended', function() {
          if (currentIndex < (numOfTracks - 1)) {
            ++currentIndex;
            $('#player:first-child').attr('src', songs[currentIndex]);
          }
        });

      })();
    </script>
  </body>
</html>